@function igx-input-group-theme(
    $idle-text-color: null,
    $filled-text-color: null,
    $focused-text-color: null,
    $disabled-text-color: null,

    $idle-secondary-color: null,
    $filled-secondary-color: null,
    $focused-secondary-color: null,

    $idle-bottom-line-color: null,
    $hover-bottom-line-color: null,
    $filled-bottom-line-color: null,
    $focused-bottom-line-color: null,
    $disabled-bottom-line-color: null,

    $box-background: null,
    $box-disabled-background: null,
    $border-background: null,
    $border-disabled-background: null,

    $search-background: null,
    $search-disabled-background: null,
    $search-shadow-color: null,
    $search-disabled-shadow-color: null,

    $success-secondary-color: null,
    $warning-secondary-color: null,
    $error-secondary-color: null,

    $variant: 'dark'
) {
    @return (
        idle-text-color: $idle-text-color,
        filled-text-color: $filled-text-color,
        focused-text-color: $focused-text-color,
        disabled-text-color: $disabled-text-color,

        idle-secondary-color: $idle-secondary-color,
        filled-secondary-color: $filled-secondary-color,
        focused-secondary-color: $focused-secondary-color,

        idle-bottom-line-color: $idle-bottom-line-color,
        hover-bottom-line-color: $hover-bottom-line-color,
        filled-bottom-line-color: $filled-bottom-line-color,
        focused-bottom-line-color: $focused-bottom-line-color,
        disabled-bottom-line-color: $disabled-bottom-line-color,

        box-background: $box-background,
        box-disabled-background: $box-disabled-background,

        border-background: $border-background,
        border-disabled-background: $border-disabled-background,

        search-background: $search-background,
        search-disabled-background: $search-disabled-background,
        search-shadow-color: $search-shadow-color,
        search-disabled-shadow-color: $search-disabled-shadow-color,

        success-secondary-color: $success-secondary-color,
        warning-secondary-color: $warning-secondary-color,
        error-secondary-color: $error-secondary-color,

        variant: $variant
    );
}

@mixin igx-input-group($theme, $palette: $default-palette) {
    $dark-theme: igx-input-group-theme(
        $idle-text-color: igx-color($palette, 'grays', 600),
        $filled-text-color: igx-color($palette, 'grays', 900),
        $focused-text-color: igx-color($palette, 'grays', 900),
        $disabled-text-color: igx-color($palette, 'grays', 500),

        $idle-secondary-color: igx-color($palette, 'grays', 600),
        $filled-secondary-color: igx-color($palette, 'grays', 600),
        $focused-secondary-color: igx-color($palette, 'primary'),

        $idle-bottom-line-color: igx-color($palette, 'grays', 600),
        $hover-bottom-line-color: igx-color($palette, 'grays', 900),
        $filled-bottom-line-color: igx-color($palette, 'grays', 600),
        $focused-bottom-line-color: igx-color($palette, 'primary'),
        $disabled-bottom-line-color: rgba(0, 0, 0, .42),

        $box-background: rgba(0, 0, 0, .06),
        $box-disabled-background: rgba(0, 0, 0, .03),

        $border-background: transparent,
        $border-disabled-background: rgba(0, 0, 0, .03),

        $search-background: white,
        $search-disabled-background: white,
        $search-shadow-color: igx-color($palette, 'grays', 600),
        $search-disabled-shadow-color: igx-color($palette, 'grays', 300),

        $success-secondary-color: igx-color($palette, 'success'),
        $warning-secondary-color: igx-color($palette, 'warn'),
        $error-secondary-color: igx-color($palette, 'error')
    );

    $light-theme: igx-input-group-theme(
        $idle-text-color: white,
        $filled-text-color: white,
        $focused-text-color: white,
        $disabled-text-color: rgba(255, 255, 255, .5),

        $idle-secondary-color: rgba(255, 255, 255, .7),
        $filled-secondary-color: rgba(255, 255, 255, .7),
        $focused-secondary-color: igx-color($palette, 'primary'),

        $idle-bottom-line-color: rgba(255, 255, 255, .7),
        $hover-bottom-line-color: white,
        $filled-bottom-line-color: rgba(255, 255, 255, .7),
        $focused-bottom-line-color: igx-color($palette, 'primary'),
        $disabled-bottom-line-color: rgba(255, 255, 255, .7),

        $box-background: rgba(255, 255, 255, .1),
        $box-disabled-background: rgba(255, 255, 255, .06),

        $border-background: transparent,
        $border-disabled-background: rgba(255, 255, 255, .06),

        $search-background: rgba(255, 255, 255, .1),
        $search-disabled-background: rgba(255, 255, 255, .06),
        $search-shadow-color: igx-color($palette, 'grays', 600),
        $search-disabled-shadow-color: igx-color($palette, 'grays', 300),

        $success-secondary-color: igx-color($palette, 'success'),
        $warning-secondary-color: igx-color($palette, 'warn'),
        $error-secondary-color: igx-color($palette, 'error')
    );

    $this: ();

    @if map-get($theme, 'variant') == 'light' {
        $this: extend($theme, $light-theme);
    } @else {
        $this: extend($theme, $dark-theme);
    }

    $transition-timing: .25s $ease-out-cubic;
    $search-shadow: igx-elevation($elevations, 1);
    $search-shadow-hover: igx-elevation($elevations, 2);
    $search-shadow-disabled: igx-elevation($elevations, 1);

    %form-group-display {
        position: relative;
        display: block;
        font-size: 1em; /* 16px, when base is 16px(html) */
        margin-top: .75em; /* 12px when base is 16px (self) */
        color: map-get($this, 'idle-text-color');
    }

    %form-group-display--no-margin {
        margin-top: 0;
    }

    %form-group-box-wrapper {
        border-radius: 4px;
        overflow: hidden;
    }

    %form-group-display--hover {
        cursor: pointer;
    }

    %form-group-display--disabled {
        pointer-events: none;
        user-select: none;
        color: map-get($this, 'disabled-text-color');
    }

    %form-group-bundle {
        position: relative;
        display: flex;
        align-items: center;
        flex-flow: row nowrap;
        box-shadow: inset 0 -1px 0 0 map-get($this, 'idle-bottom-line-color');
        transition: box-shadow $transition-timing, color $transition-timing;
    }

    %form-group-bundle--box {
        padding: 1.125em 1em 0;
        background: map-get($this, 'box-background');
        box-shadow: inset 0 -.125em 0 0 map-get($this, 'idle-bottom-line-color');

        %form-group-label--box + %form-group-input--box {
            transform: translateY(0);
        }
    }

    %form-group-bundle--hover {
        cursor: pointer;
        box-shadow: inset 0 -.125em 0 0 map-get($this, 'hover-bottom-line-color');
    }

    %form-group-bundle--focus {
        caret-color: map-get($this, 'focused-secondary-color');
        box-shadow: inset 0 -.125em 0 0 rgba(map-get($this, 'focused-bottom-line-color'), .12);
    }

    %form-group-bundle--success {
        caret-color: map-get($this, 'success-secondary-color');
        box-shadow: inset 0 -.0625em 0 0 map-get($this, 'success-secondary-color');
    }

    %form-group-bundle--error {
        caret-color: map-get($this, 'error-secondary-color');
        box-shadow: inset 0 -.0625em 0 0 map-get($this, 'error-secondary-color');
    }

    %form-group-bundle--disabled {
        box-shadow: none;
        background-image: linear-gradient(to right, map-get($this, 'disabled-bottom-line-color') 40%, transparent 10%);
        background-position: bottom;
        background-size: 4px 1px;
        background-repeat: repeat-x;
    }

    %form-group-bundle--box-disabled {
        background: map-get($this, 'box-disabled-background');
    }

    %form-group-bundle--border {
        padding: 1.125em 1em 0;
        box-shadow: inset 0 0 0 .0625em map-get($this, 'idle-bottom-line-color');
        border-radius: 4px;
        background: map-get($this, 'border-background');

        %form-group-label--box + %form-group-input--box {
            transform: translateY(0);
        }
    }

    %form-group-bundle-border--hover {
        box-shadow: inset 0 0 0 .125em map-get($this, 'idle-text-color');
    }

    %form-group-bundle-border--focus {
        box-shadow: inset 0 0 0 .125em map-get($this, 'focused-bottom-line-color');
    }

    %form-group-bundle-border--error {
        box-shadow: inset 0 0 0 .125em map-get($this, 'error-secondary-color');
    }

    %form-group-bundle-border--success {
        box-shadow: inset 0 0 0 .125em map-get($this, 'success-secondary-color');
    }

    %form-group-bundle-border--disabled {
        background: map-get($this, 'border-disabled-background');
        box-shadow: inset 0 0 0 .0625em rgba(map-get($this, 'disabled-text-color'), .06);
    }

    %form-group-bundle--search {
        padding: 1.125em 1em 0;
        border-radius: 4px;
        border-bottom: none;
        background: map-get($this, 'search-background');
        box-shadow: $search-shadow;

        %form-group-label--box + %form-group-input--box {
            transform: translateY(0);
        }
    }

    %form-group-bundle-search--hover {
        box-shadow: $search-shadow-hover;
    }

    %form-group-bundle-search--focus {
        box-shadow: $search-shadow-hover;
    }

    %form-group-bundle-search--error {
        box-shadow: $search-shadow-hover;
    }

    %form-group-bundle-search--success {
        box-shadow: $search-shadow-hover;
    }

    %form-group-bundle-search--disabled {
        background: map-get($this, 'search-disabled-background');
        box-shadow: $search-shadow-disabled;
    }

    %form-group-bundle-main {
        position: relative;
        flex-grow: 1;
    }

    %form-group-label {
        @include ellipsis();
        position: absolute;
        width: 100%;
        transform: translateY(.5em); /* 8px, base is 16px */
        font-size: 1em; /* 16px, base is 16px */
        line-height: 1;
        height: 1.125em; /* 18px, base is 16px(self) */
        backface-visibility: hidden;
        will-change: transform;
        transform-origin: top left;
        transition: transform $transition-timing, color $transition-timing;

        [dir="rtl"] & {
            transform-origin: top right;
        }
    }

    %form-group-label--box {
        transform: translateY(0);
    }

    %form-group-label--float {
        transform: translateY(-50%) scale(.75);
    }

    %form-group-label--fixed {
        transition: color $transition-timing;
    }

    %form-group-label--focus {
        color: map-get($this, 'focused-secondary-color');
    }

    %form-group-label--success {
        color: map-get($this, 'success-secondary-color');
    }

    %form-group-label--error {
        color: map-get($this, 'error-secondary-color');
    }

    %form-group-label--required {
        &::after {
            content: '*';
            font-size: inherit;
            vertical-align: top;
            margin-left: .125em; /* 2px base is 16px */
            line-height: 1;
        }
    }

    %form-group-input {
        position: relative;
        border: none;
        font-size: 1em;
        line-height: 1em;
        height: 2em; /* 32px, base is 16px */
        padding: 0 0 .5em; /* 8px, base is 16px */
        border-top: .5em solid rgba(0, 0, 0, 0);
        width: 100%;
        min-width: 0;
        overflow: visible;
        font-family: inherit;
        background: transparent;
        color: map-get($this, 'filled-text-color');
        outline-style: none;
        box-shadow: none;
    }

    %chrome-autofill-fix {
        &:-webkit-autofill,
        &:-webkit-autofill:hover,
        &:-webkit-autofill:focus,
        &:-webkit-autofill:active { -webkit-transition-delay: 99999s; }
    }

    %form-group-input--box {
        transform: translateY(-25%);
    }

    %form-group-input--hover {
        cursor: pointer;
    }

    %form-group-input--focus {
        cursor: text;
        color: map-get($this, 'focused-text-color');
    }

    %form-group-input--disabled {
        color: map-get($this, 'disabled-text-color');
    }

    %form-group-textarea {
        min-height: 5.125em; /* 3 lines * 22px + 8px bottom padding + 8px top padding */
        margin-right: -1em; /* this fixes resizing in chrome !?!? */
        height: auto;
        line-height: 1.375em; /* 22px, base is 16px */
        resize: vertical;
        overflow: hidden;

        [dir="rtl"] & {
            margin-right: initial;
            margin-left: -1em;
        }
    }

    %form-group-textarea--box {
        width: calc(100% + 2em); /* add the padding to the width */
        margin: 0 -1em;
        padding-left: 1em;
        padding-right: 1em;
    }

    %form-group-prefix,
    %form-group-suffix {
        line-height: 1;
        height: 2em; /* 32px, base is 16px */
        transition: all $transition-timing;

        igx-icon {
            display: inline-flex;
            align-items: center;
            font-size: 1.5em;
            height: .75em; /* 24px, base is 32px */
            line-height: .6667em; /* 16px, base is 24px */
        }
    }

    %form-group-prefix {
        padding: .5em .5em .5em 0; /* 8px, base is 16px */

        [dir="rtl"] & {
            padding: .5em 0 .5em .5em; /* 8px, base is 16px */
        }
    }

    %form-group-suffix {
        padding: .5em 0; /* 8px, base is 16px */
    }

    %form-group-prefix--box,
    %form-group-suffix--box {
        height: 100%;
        transform: translateY(-25%);
    }

    %form-group-prefix--box {
        padding: 0 .5em 0 0; /* 8px, base is 16px */

        [dir="rtl"] & {
            padding: 0 0 0 .5em; /* 8px, base is 16px */
        }
    }

    %form-group-suffix--box {
        padding: 0;
    }

    %form-group-prefix--error,
    %form-group-suffix--error {
        color: map-get($this, 'error-secondary-color');
    }

    %form-group-border {
        height: .125em; /* 2px, when base is 16px */
        margin-top: -.125em; /* 2px, when base is 16px */
        transform: scaleX(0);
        transform-origin: center;
        background: map-get($this, 'focused-secondary-color');
    }

    %form-group-border--focus {
        transform: scaleX(1);
        transition: transform $transition-timing;
    }

    %form-group-border--success {
        background: map-get($this, 'success-secondary-color');
    }

    %form-group-border--warning {
        background: map-get($this, 'warning-secondary-color');
    }

    %form-group-border--error {
        background: map-get($this, 'error-secondary-color');
    }

    %form-group-border--hidden {
        display: none;
    }

    %form-group-helper {
        position: relative;
        display: flex;
        justify-content: space-between;
        font-size: .75em; /* 12px */
        padding-top: .6667em; /* 8px, base is 12px */
        line-height: 1.125em; /* 13.5px, base is 12px */
    }

    %form-group-helper--box {
        margin-left: 1.3333em; /* 16px, base is 12px */
        margin-right: 1.3333em; /* 16px, base is 12px */
    }

    %form-group-helper--success {
        color: map-get($this, 'success-secondary-color');
    }

    %form-group-helper--error {
        color: map-get($this, 'error-secondary-color');
    }

    %form-group-helper-item {
        @include ellipsis();
        position: relative;
        min-width: 0;
        max-width: 100%;
    }

    %form-group-helper-item--start {
        order: 0;
    }

    %form-group-helper-item--end {
        order: 1;
    }
}
